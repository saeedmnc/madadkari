(function () {
	if ('onhashchange' in window && 'querySelector' in document) {

		var originalTitle = document.title;

		window.onhashchange = checkHash;

		checkHash();
		var tocActive = document.querySelector('.toc [active="true"]')
		if (tocActive) {
			makeSureElementInView(tocActive, document.querySelector('.toc'))
		}

		function checkHash() {
			var tocActive = document.querySelector('.toc [active="true"]')
			if (tocActive) {
				tocActive.removeAttribute('active')
			}

			var hash = location.hash;
			if (hash) {
				var target = document.querySelector(hash);
				if (target) {
					var id = target.getAttribute('data-id');
					var name = target.getAttribute('data-name');
					document.title = id + (name ? ' - ' + name : '');

					var anchor = document.querySelector('.toc a[href="' + hash + '"]')
					if (anchor) {
						tocActive = anchor.parentNode
						if (tocActive) {
							tocActive.setAttribute('active', 'true')
							makeSureElementInView(tocActive, document.querySelector('.toc'))
						}
					}
				} else {
					document.title = originalTitle;
				}
			}
		}

		function makeSureElementInView(el, positionParentElement) {
			var rect = el.getBoundingClientRect();
			if (rect.top < 0) {
				positionParentElement.scrollTop += rect.top - 10
			} else if (rect.top > screen.height) {
				positionParentElement.scrollTop += rect.top - screen.height * 1.5
			}
		}
	}
})();